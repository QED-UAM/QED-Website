<%- include("../partials/header", { title: __("magazine.post.title", { name: post.title }) }) %>
<script src="/js/postInteractiveElements.js"></script>
<script src="/js/spoilerOverlay.js"></script>
<script src="/js/incrementPostViews.js"></script>
<script src="/js/postUtils.js"></script>

<head>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Article",
        "headline": "<%= post.title %>",
        "author": [
            <% post.authors.forEach(function(author, index) { %>
            {
                "@type": "Person",
                "name": "<%= author.name %>",
                "url": "<%= author.url %>"
            }<% if (index < post.authors.length - 1) { %>,<% } %>
            <% }) %>
        ],
        "datePublished": "<%= post.created_at %>",
        "dateModified": "<%= post.updated_at %>",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "<%= post.url %>"
        },
        "publisher": {
            "@type": "Organization",
            "name": "QED",
            "url": "https://qed.mat.uam.es"
        }
    }
    </script>
</head>

<div class="mx-4">
    <h1 class="text-5xl sm:text-6xl flex items-center space-x-2 font-bold <%= post.noTranslation ? 'text-red-700 dark:text-red-200 underline decoration-dotted' : 'text-blue-700 dark:text-blue-200' %>" <%- post.noTranslation ? `title="${__('magazine.post.noTranslation')}"` : '' %>>
        <% if (post.noTranslation) { %>
            <%- include("../partials/components/icons/translate", { size: 12 }) %>
        <% } %>
        <p><%= post.title %></p>
    </h1>
    <div class="flex flex-col sm:flex-row justify-between mt-4">
        <%- include("../partials/components/tags", { tags: post.tags, big: true }) %>
    </div>
</div>
<div class="max-w-2xl mx-auto p-4">
    <% if (post.type !== "post") { %>
    <p class="text-3xl text-black dark:text-white italic uppercase font-bold"><%= __(`postTypes.${post.type}`) %></p>
    <% } %>
    <!--<p class="text-gray-700 dark:text-gray-200"><%= post.description %></p>-->

    <!-- Author Info -->
    <div class="flex flex-col sm:flex-row flex-wrap">
        <% post.authors.forEach((author) => { %>
            <div class="flex mt-4 sm:mt-6 sm:mr-6 items-center">

                <a href="/<%= __('profile.url') %>/<%= author.url %>" target="_blank" rel="noopener noreferrer">
                    <img src="<%= author.photo %>" alt="<%= author.name %>" class="w-8 h-8 min-w-8 sm:w-12 sm:h-12 rounded-full border-2 border-gray-200 dark:border-gray-600 pointer-events-none" onerror="this.onerror=null;this.src='https://i.pinimg.com/736x/2c/f5/58/2cf558ab8c1f12b43f7326945672805e.jpg';">
                </a>
                <div class="ml-2 mt-0">
                    <a href="/<%= __('profile.url') %>/<%= author.url %>" target="_blank" rel="noopener noreferrer">
                        <h3 class="font-semibold underline"><%= author.name %></h3>
                    </a>
                    <p class="text-gray-500 dark:text-gray-400"><%= __(`roles.${author.role}`) %></p>
                </div>
            </div>
        <% }); %>
    </div>

    <!-- Post Content -->
    <div id="post-md" class="text-slate-700 dark:text-slate-100 text-md mt-12 mx-2 text-justify prose dark:prose-invert mobile:prose-lg max-w-none break-words prose-custom">
        <%- post.content %>
        <hr>
    </div>
    <ul class="mt-12 list-disc list-inside">
        <% post.authors.forEach((author) => { %>
            <li class="space-x-2 items-center">
                <a href="/<%= __('profile.url') %>/<%= author.url %>" target="_blank" rel="noopener noreferrer" style="display: inline-block;">
                    <h3 class="font-semibold underline text-md"><%= author.name %></h3>
                </a>
                <p class="text-gray-500 dark:text-gray-400" style="display: inline-block;">(<%= __(`roles.${author.role}`) %>)</p>
            </li>
        <% }); %>
    </ul>
    
            
    <!-- Additional Metadata -->
    <div class="mt-6">
        <div class="mt-2 text-sm text-gray-500 dark:text-gray-400">
            <a href="/<%= __('magazine.index.url') %>/<%= post.magazine.url %>" class="text-blue-500 dark:text-blue-300 hover:underline">
                &larr; <%= __("magazine.index.title") %>: <%= post.magazine.title %>
            </a>
        </div>
    </div>

    <% if (post.scripts) { %>
        <textarea id="scripts" class="hidden"><%- post.scripts %></textarea>
        <script>
            const element = document.getElementById("scripts");
            activateInteractiveElements([element.value]);
            element.remove();
        </script>
    <% } %>
</div>

<%- include("../partials/footer") %>
